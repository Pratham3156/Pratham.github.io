<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>My Profile</title>
  <meta name="viewport" content="width=device-width, initial-scale=1.0">

  <style>
    body {
      margin: 0;
      font-family: Arial, sans-serif;
      background: #0f0f0f;
      color: white;
      display: flex;
      justify-content: center;
      align-items: center;
      height: 100vh;
    }

    ..avatar-wrapper {
  position: relative;
  width: 120px;
  height: 120px;
  margin: 20px auto;
  cursor: pointer;
}

.avatar-initials {
  width: 100%;
  height: 100%;
  background: #1db954;
  color: black;
  font-size: 40px;
  font-weight: bold;
  display: flex;
  align-items: center;
  justify-content: center;
  border-radius: 50%;
}

.profile-image {
  width: 100%;
  height: 100%;
  border-radius: 50%;
  object-fit: cover;
  display: none;
}
</head>
<body>

 <div class="profile-card">

  <div class="avatar-wrapper">
    <div id="avatarInitials" class="avatar-initials"></div>
    <img id="profileImage" class="profile-image" />
    <input type="file" id="imageUpload" hidden />
  </div>

  <h2 id="usernameText">Player</h2>
  <p id="emailText"></p>

  <button onclick="triggerUpload()">Change Profile Picture</button>

</div>
  <script type="module">
    import { auth } from "./firebase.js";
    import { onAuthStateChanged, signOut } 
    from "https://www.gstatic.com/firebasejs/10.7.1/firebase-auth.js";

    const nameEl = document.getElementById("userName");
    const emailEl = document.getElementById("userEmail");
    const imageEl = document.getElementById("profileImage");

    onAuthStateChanged(auth, (user) => {
      if (!user) {
        location.replace("login.html");
        return;
      }

      nameEl.innerText = user.displayName || "User";
      emailEl.innerText = user.email;

      if (user.photoURL) {
        imageEl.src = user.photoURL;
      }
    });

    window.logout = function () {
      signOut(auth).then(() => {
        location.replace("login.html");
      });
    };

    window.goBack = function () {
      history.back();
    };
  </script>
<script>
document.addEventListener("DOMContentLoaded", function() {

  const avatarInitials = document.getElementById("avatarInitials");
  const profileImage = document.getElementById("profileImage");
  const imageUpload = document.getElementById("imageUpload");

  function extractInitials(email) {
    let name = email.split("@")[0];
    name = name.replace(/[^a-zA-Z]/g, "");
    if (!name) return "P";

    return name.charAt(0).toUpperCase() +
           (name.charAt(1)?.toUpperCase() || "");
  }

  firebase.auth().onAuthStateChanged(function(user) {
    if (!user) {
      window.location.href = "login.html";
      return;
    }

    document.getElementById("usernameText").innerText =
      user.email.split("@")[0];

    document.getElementById("emailText").innerText = user.email;

    const savedImage = localStorage.getItem("profileImage_" + user.uid);

    if (savedImage) {
      profileImage.src = savedImage;
      profileImage.style.display = "block";
      avatarInitials.style.display = "none";
    } else {
      avatarInitials.innerText = extractInitials(user.email);
      avatarInitials.style.display = "flex";
      profileImage.style.display = "none";
    }
  });

  window.triggerUpload = function() {
    imageUpload.click();
  };

  imageUpload.addEventListener("change", function(e) {
    const file = e.target.files[0];
    if (!file) return;

    const reader = new FileReader();

    reader.onload = function(event) {
      const base64Image = event.target.result;

      const user = firebase.auth().currentUser;
      localStorage.setItem(
        "profileImage_" + user.uid,
        base64Image
      );

      profileImage.src = base64Image;
      profileImage.style.display = "block";
      avatarInitials.style.display = "none";
    };

    reader.readAsDataURL(file);
  });

});
</script>
</body>
</html>
